<!DOCTYPE html>
<html lang="id" class="h-full">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SIAS Soeradji - Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <meta name="csrf-token" content="{{ csrf_token() }}">
  
  <style>
    /* CSS Variables */
    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f9fafb;
      --text-primary: #1f2937;
      --text-secondary: #6b7280;
      --border-color: #e5e7eb;
      --sidebar-bg: #ffffff;
      --header-bg: #ffffff;
      --card-bg: #ffffff;
    }
    
    [data-theme="dark"] {
      --bg-primary: #111827;
      --bg-secondary: #1f2937;
      --text-primary: #f9fafb;
      --text-secondary: #d1d5db;
      --border-color: #374151;
      --sidebar-bg: #1f2937;
      --header-bg: rgba(31, 41, 59, 0.8);
      --card-bg: #1f2937;
    }
    
    /* CSS Animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-20px); }
    }
    
    /* Glassmorphism */
    .glass {
      background: rgba(255, 255, 255, 0.25);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    /* Dark Mode Support */
    .dark {
      background: linear-gradient(180deg, #111827 0%, #1f2937 0%, #1f2937 0.85%);
    }
    
    /* Enhanced Sidebar */
    .sidebar {
      background: var(--sidebar-bg);
      backdrop-filter: blur(16px);
      border-right: 1px solid var(--border-color);
      box-shadow: 4px 0 20px rgba(0, 0, 0, 0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Main Content */
    .main-content {
      background: var(--bg-primary);
      transition: background-color 0.3s ease;
      width: calc(100% - 256px);
      margin-left: 256px;
      position: relative;
    }
    
    /* Enhanced Chat Sidebar - Memperbaiki posisi */
    .chat-sidebar {
      background: var(--card-bg);
      backdrop-filter: blur(16px);
      border-left: 1px solid var(--border-color);
      box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
      position: fixed;
      right: 0;
      top: 0;
      height: 100vh;
      width: 64px; /* Lebar default saat tertutup */
      z-index: 30;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Chat Sidebar saat hover */
    .chat-sidebar:hover {
      width: 320px; /* Lebar saat hover */
    }
    
    /* Chat Box */
    .chat-box {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
      position: fixed;
      bottom: 20px;
      right: 80px; /* Dipindahkan lebih ke kiri agar tidak tertutup sidebar */
      z-index: 40;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    /* Chat Box Minimized */
    .chat-box.minimized {
      transform: scale(0.8) translateY(20px);
      opacity: 0.8;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .main-content {
        width: 100%;
        margin-left: 0;
        margin-right: 64px; /* Ruang untuk chat sidebar */
      }
      
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.open {
        transform: translateX(0);
      }
      
      .chat-sidebar {
        width: 48px; /* Lebar default saat tertutup di tablet */
      }
      
      .chat-sidebar:hover {
        width: 280px; /* Lebar saat hover di tablet */
      }
      
      .chat-box {
        right: 60px; /* Dipindahkan lebih ke kiri di tablet */
      }
    }
    
    @media (max-width: 768px) {
      .main-content {
        margin-right: 0; /* Tidak ada ruang untuk chat sidebar di mobile */
      }
      
      .chat-sidebar {
        transform: translateX(100%); /* Sembunyikan di mobile */
      }
      
      .chat-box {
        right: 20px; /* Posisi normal di mobile */
        width: calc(100% - 40px); /* Lebar penuh di mobile */
        max-width: 400px;
      }
    }
    
    .floating {
      animation: float 6s ease-in-out infinite;
    }
    
    .welcome-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }
    
    .stat-card {
      background: white;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }
    
    .menu-item {
      transition: all 0.2s ease;
    }
    
    .menu-item:hover {
      background-color: rgba(59, 130, 246, 0.1);
      transform: translateX(5px);
    }
    
    .submenu-item {
      transition: all 0.2s ease;
    }
    
    .submenu-item:hover {
      background-color: rgba(59, 130, 246, 0.05);
    }
    
    .notification-dropdown {
      background: white;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .dark .notification-dropdown {
      background: #1f2937;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .header {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .dark .header {
      background: rgba(31, 41, 59, 0.9);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .profile-fab {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .online-indicator {
      position: absolute;
      bottom: 0;
      right: 0;
    }
    
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.1);
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }
    
    .dark .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .dark .custom-scrollbar::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .dark .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: rgba(255, 255, 255, 0.3);
    }
    
    /* Perbaikan untuk konten yang tertutup sidebar */
    .content-wrapper {
      padding-right: 80px; /* Memberikan ruang untuk sidebar kanan */
    }
    
    @media (max-width: 1024px) {
      .content-wrapper {
        padding-right: 64px;
      }
    }
    
    @media (max-width: 768px) {
      .content-wrapper {
        padding-right: 20px;
      }
    }
    
    /* Loading Animation */
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }
    
    /* Optimized transitions */
    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* Smooth scrolling */
    html {
      scroll-behavior: smooth;
    }
    
    /* Hide scrollbar but keep functionality */
    .hide-scrollbar {
      -ms-overflow-style: none;
      scrollbar-width: none;
    }
    
    .hide-scrollbar::-webkit-scrollbar {
      display: none;
    }
  </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen font-sans text-sm text-gray-600 antialiased" 
      x-data="dashboardApp()" 
      x-init="init()" 
      :class="{ 'dark': darkMode }"
      :data-theme="darkMode ? 'dark' : 'light'">

<script>
function dashboardApp() {
  return {
    sidebarOpen: false,
    profileMenuOpen: false,
    chatBoxOpen: false,
    chatMinimized: false,
    chatUserId: null,
    selectedChatUser: null,
    notificationsOpen: false,
    unreadNotifications: [],
    unreadCount: 0,
    onlineUsers: [],
    darkMode: localStorage.getItem('theme') === 'dark',
    theme: localStorage.getItem('theme') || 'light',
    stats: {
      total_arsip_aktif: 0,
      total_arsip_inaktif: 0,
      total_surat_tugas: 0,
      total_berita_pemindahan: 0,
      total_berita_pemusnahan: 0,
      total_berita_alihmedia: 0
    },
    todayActivities: [],
    currentUser: {
      id: {{ auth()->id() }},
      name: "{{ auth()->user()->nama_lengkap }}",
      role: "{{ auth()->user()->role }}",
      initials: "{{ $user->initials }}",
      avatar: "{{ !empty($user->profile->foto) ? asset('storage/profiles/' . $user->profile->foto) : '' }}"
    },
    loading: {
      stats: true,
      notifications: true,
      onlineUsers: true,
      activities: true
    },
    lastUpdated: {
      stats: null,
      notifications: null,
      onlineUsers: null,
      activities: null
    },
    updateInterval: {
      stats: 60000, // 1 menit
      notifications: 30000, // 30 detik
      onlineUsers: 30000, // 30 detik
      activities: 60000 // 1 menit
    },

    init() {
      this.checkDarkMode();
      this.loadInitialData();
      this.setupIntervals();
      this.addCurrentUserToOnlineList();
      
      // Setup WebSocket atau Pusher untuk real-time updates (opsional)
      this.setupRealtimeUpdates();
    },
    
    setupIntervals() {
      // Setup interval untuk update data
      setInterval(() => {
        this.checkAndUpdateData('stats');
      }, this.updateInterval.stats);
      
      setInterval(() => {
        this.checkAndUpdateData('notifications');
      }, this.updateInterval.notifications);
      
      setInterval(() => {
        this.checkAndUpdateData('onlineUsers');
      }, this.updateInterval.onlineUsers);
      
      setInterval(() => {
        this.checkAndUpdateData('activities');
      }, this.updateInterval.activities);
    },
    
    checkAndUpdateData(dataType) {
      const now = new Date();
      const lastUpdate = this.lastUpdated[dataType];
      
      // Update hanya jika belum pernah diupdate atau sudah melewati interval
      if (!lastUpdate || (now - lastUpdate) >= this.updateInterval[dataType]) {
        this.loadSpecificData(dataType);
        this.lastUpdated[dataType] = now;
      }
    },
    
    loadInitialData() {
      // Load semua data awal secara paralel
      Promise.all([
        this.loadStats(),
        this.loadNotifications(),
        this.loadOnlineUsers(),
        this.loadTodayActivities()
      ]).then(() => {
        console.log('All initial data loaded');
      }).catch(error => {
        console.error('Error loading initial data:', error);
      });
    },
    
    loadSpecificData(dataType) {
      switch(dataType) {
        case 'stats':
          this.loadStats();
          break;
        case 'notifications':
          this.loadNotifications();
          break;
        case 'onlineUsers':
          this.loadOnlineUsers();
          break;
        case 'activities':
          this.loadTodayActivities();
          break;
      }
    },
    
    loadStats() {
      this.loading.stats = true;
      fetch('/api/dashboard/stats')
        .then(response => response.json())
        .then(data => {
          this.stats = data;
          this.loading.stats = false;
          this.lastUpdated.stats = new Date();
        })
        .catch(err => {
          console.error('Error memuat stats:', err);
          this.loading.stats = false;
        });
    },
    
    loadNotifications() {
      this.loading.notifications = true;
      fetch('/api/notifications/unread')
        .then(response => response.json())
        .then(data => {
          this.unreadNotifications = data.notifications;
          this.unreadCount = data.count;
          this.loading.notifications = false;
          this.lastUpdated.notifications = new Date();
        })
        .catch(err => {
          console.error('Error memuat notifications:', err);
          this.loading.notifications = false;
        });
    },
    
    loadOnlineUsers() {
      this.loading.onlineUsers = true;
      fetch('/api/users/online')
        .then(response => response.json())
        .then(data => {
          this.onlineUsers = data;
          this.addCurrentUserToOnlineList();
          this.loading.onlineUsers = false;
          this.lastUpdated.onlineUsers = new Date();
        })
        .catch(err => {
          console.error('Error memuat online users:', err);
          this.loading.onlineUsers = false;
        });
    },
    
    loadTodayActivities() {
      this.loading.activities = true;
      fetch('/api/activities/today')
        .then(response => response.json())
        .then(data => {
          this.todayActivities = data;
          this.loading.activities = false;
          this.lastUpdated.activities = new Date();
        })
        .catch(err => {
          console.error('Error memuat aktivitas hari ini:', err);
          this.loading.activities = false;
        });
    },
    
    setupRealtimeUpdates() {
      // Implementasi WebSocket atau Pusher untuk real-time updates
      // Ini adalah placeholder, implementasi sesungguhnya tergantung pada teknologi yang digunakan
      
      // Contoh dengan Pusher (jika digunakan)
      /*
      if (typeof Pusher !== 'undefined') {
        const pusher = new Pusher('your-pusher-key', {
          cluster: 'your-cluster'
        });
        
        const channel = pusher.subscribe('dashboard-updates');
        channel.bind('new-notification', (data) => {
          this.unreadNotifications.unshift(data);
          this.unreadCount++;
        });
        
        channel.bind('user-online', (data) => {
          if (!this.onlineUsers.some(user => user.id === data.id)) {
            this.onlineUsers.push(data);
          }
        });
        
        channel.bind('user-offline', (data) => {
          this.onlineUsers = this.onlineUsers.filter(user => user.id !== data.id);
        });
      }
      */
    },
    
    addCurrentUserToOnlineList() {
      if (!this.onlineUsers.some(user => user.id === this.currentUser.id)) {
        this.onlineUsers.unshift({
          id: this.currentUser.id,
          nama_lengkap: this.currentUser.name,
          role: this.currentUser.role,
          initials: this.currentUser.initials,
          avatar_url: this.currentUser.avatar,
          last_activity_formatted: 'Sekarang'
        });
      }
    },

    checkDarkMode() {
      this.darkMode = localStorage.getItem('theme') === 'dark';
      
      if (this.darkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.documentElement.classList.remove('dark');
      }
    },

    toggleDarkMode() {
      this.darkMode = !this.darkMode;
      this.theme = this.darkMode ? 'dark' : 'light';

      localStorage.setItem('theme', this.theme);

      if (this.darkMode) {
        document.documentElement.setAttribute('data-theme', 'dark');
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.removeAttribute('data-theme');
        document.documentElement.classList.remove('dark');
      }
    },

    toggleSidebar() {
      this.sidebarOpen = !this.sidebarOpen;
    },

    toggleProfileMenu() {
      this.profileMenuOpen = !this.profileMenuOpen;
      this.notificationsOpen = false;
    },

    toggleNotifications() {
      this.notificationsOpen = !this.notificationsOpen;
      this.profileMenuOpen = false;
      
      // Tandai notifikasi sebagai dibaca saat dropdown dibuka
      if (this.notificationsOpen && this.unreadCount > 0) {
        this.markAllNotificationsAsRead();
      }
    },

    openChat(userId) {
      this.chatUserId = userId;
      // Cari data user lengkap dari daftar onlineUsers berdasarkan ID
      this.selectedChatUser = this.onlineUsers.find(user => user.id === userId);
      
      this.chatBoxOpen = true;
      this.chatMinimized = false;
      this.loadChat(userId);
    },

    minimizeChat() {
      this.chatMinimized = !this.chatMinimized;
    },

    closeChat() {
      this.chatBoxOpen = false;
      this.chatMinimized = false;
      this.chatUserId = null;
      this.selectedChatUser = null;
    },

    loadChat(userId) {
      fetch(`/api/chat/${userId}`)
        .then(response => response.json())
        .then(data => {
          this.displayChatMessages(data.messages);
        })
        .catch(err => console.error('Error memuat chat:', err));
    },

    displayChatMessages(messages) {
      console.log('Displaying messages:', messages);
      // Implementasi tampilan pesan chat
    },

    markNotificationAsRead(id) {
      fetch(`/api/notifications/${id}/read`, { 
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            this.unreadCount = Math.max(0, this.unreadCount - 1);
            const notificationIndex = this.unreadNotifications.findIndex(n => n.id === id);
            if (notificationIndex !== -1) {
              this.unreadNotifications.splice(notificationIndex, 1);
            }
          }
        })
        .catch(err => console.error('Error memperbarui notifikasi:', err));
    },
    
    markAllNotificationsAsRead() {
      fetch('/api/notifications/read-all', { 
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        }
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            this.unreadCount = 0;
            this.unreadNotifications = [];
          }
        })
        .catch(err => console.error('Error memperbarui notifikasi:', err));
    },
    
    sendMessage() {
      const messageInput = document.getElementById('chat-message-input');
      const message = messageInput.value.trim();
      
      if (!message) return;
      
      fetch('/api/chat/send', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        },
        body: JSON.stringify({
          receiver_id: this.chatUserId,
          message: message
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          messageInput.value = '';
          this.loadChat(this.chatUserId);
        } else {
          console.error('Error sending message:', data.message);
        }
      })
      .catch(err => console.error('Error sending message:', err));
    }
  }
}
</script>

    <!-- Animated Background -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
      <div class="absolute -top-40 -right-40 w-80 h-80 bg-purple-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 floating"></div>
      <div class="absolute -bottom-40 -left-40 w-80 h-80 bg-yellow-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 floating" style="animation-delay: 2s;"></div>
      <div class="absolute top-40 left-40 w-80 h-80 bg-pink-300 rounded-full mix-blend-multiply filter blur-xl opacity-70 floating" style="animation-delay: 4s;"></div>
    </div>

    <!-- Enhanced Sidebar dengan Dark Mode Support -->
    <aside class="sidebar fixed top-0 left-0 h-full w-64 z-30 overflow-y-auto transition-all duration-300" :class="{ 'translate-x-0': sidebarOpen, '-translate-x-full lg:translate-x-0': !sidebarOpen }">
      <!-- Header Sidebar -->
      <div class="p-4 border-b border-gray-200 dark:border-gray-700">
        <div class="flex justify-center mb-4">
          <a href="{{ route('dashboard') }}" class="group">
            <img src="{{ asset('img/logo-soeradji.png') }}" class="w-[120px] h-[40px] object-contain transition-transform group-hover:scale-110 filter drop-shadow-lg" />
          </a>
        </div>

        <!-- User Info dengan Dark Mode Support -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl p-4 shadow-xl">
          <div class="flex gap-3 items-center">
            @if(!empty($user->profile->foto))
              <div class="relative">
                <img src="{{ asset('storage/profiles/' . $user->profile->foto) }}" class="rounded-full w-12 h-12 object-cover border-2 border-white/50 shadow-lg" alt="Foto Profil"/>
                <div class="online-indicator">
                  <div class="w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                </div>
              </div>
            @else
              <div class="relative">
                <div class="rounded-full w-12 h-12 bg-white/20 flex items-center justify-center border-2 border-white/50 shadow-lg">
                  <span class="text-white font-bold text-lg">{{ $user->initials }}</span>
                </div>
                <div class="online-indicator">
                  <div class="w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                </div>
              </div>
            @endif
            <div class="text-xs leading-tight">
              <p class="font-bold text-white text-shadow">{{ $user->nama_lengkap }}</p>
              <p class="text-blue-100 text-shadow">{{ $user->jabatan }}</p>
              <p class="text-blue-200 italic text-xs text-shadow">{{ ucfirst($user->role) }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Menu dengan Dark Mode Support -->
      <nav class="p-4 flex flex-col gap-1">
        <!-- Beranda -->
        <a href="{{ route('dashboard') }}" class="menu-item flex items-center gap-3 px-4 py-3 rounded-lg bg-white/10 backdrop-blur-sm">
          <i class="fas fa-th-large text-lg"></i>
          <span class="font-medium">Beranda</span>
        </a>

        <!-- Registrasi Arsip -->
    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-4">Registrasi Arsip</div>

        @if(in_array($user->role, ['admin', 'arsiparis', 'pejabat_struktural']))
        <div x-data="{ open: false }" class="mt-2">
          <button @click="open = !open" class="menu-item flex items-center justify-between w-full px-4 py-3 rounded-lg hover:bg-white/10">
            <span class="flex items-center gap-3">
              <i class="fas fa-folder-plus text-lg text-green-300"></i>
              <span class="font-medium">Registrasi Arsip</span>
            </span>
            <i :class="open ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" class="text-xs"></i>
          </button>
          <div :class="open ? 'max-h-96' : 'max-h-0'" class="overflow-hidden transition-all duration-300">
            <div class="submenu ml-4 mt-2 flex flex-col gap-1 py-2">
              <a href="{{ route('arsip.aktif.create') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-folder-open text-green-300 w-4"></i> 
                <span>Arsip Aktif</span>
              </a>
              <a href="{{ route('arsip.inaktif.create') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-archive text-green-300 w-4"></i> 
                <span>Arsip Inaktif</span>
              </a>
              <a href="{{ route('arsip.vital.create') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-shield-alt text-green-300 w-4"></i> 
                <span>Arsip Vital</span>
              </a>
              <a href="{{ route('arsip.alihmedia.create') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-exchange-alt text-green-300 w-4"></i> 
                <span>Arsip Alih Media</span>
              </a>
            </div>
          </div>
        </div>
        @endif

<!-- Surat Tugas -->
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
  <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-4">
    Surat Tugas
  </div>

  @if(in_array($user->role, ['admin', 'arsiparis', 'pejabat_struktural']))
  <div x-data="{ open: false }" class="mt-2">
    <button @click="open = !open" 
      class="menu-item flex items-center justify-between w-full px-4 py-3 rounded-lg hover:bg-white/10 transition-all duration-300">
      <span class="flex items-center gap-3">
        <i class="fas fa-envelope-open-text text-lg text-indigo-400"></i>
        <span class="text-gray-700 dark:text-gray-200 font-normal">Surat Tugas</span>
      </span>
      <i :class="open ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" class="text-xs text-gray-400"></i>
    </button>

    <!-- Submenu -->
    <div :class="open ? 'max-h-96' : 'max-h-0'" 
         class="overflow-hidden transition-all duration-300">
      <div class="submenu ml-4 mt-2 flex flex-col gap-1 py-2">

        <a href="{{ route('surat_tugas.form') }}" 
           class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm hover:bg-indigo-500/10">
          <i class="fas fa-file-alt text-indigo-400 w-4"></i>
          <span class="text-gray-700 dark:text-gray-200 font-normal">ST 1 dan 2 orang</span>
        </a>
        
        <a href="{{ route('log_surat_tugas.index') }}" 
           class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm hover:bg-indigo-500/10">
          <i class="fas fa-history text-indigo-400 w-4"></i>
          <span class="text-gray-700 dark:text-gray-200 font-normal">Log Surat Tugas</span>
        </a>
      </div>
    </div>
  </div>
  @endif
</div>

<!-- Watermark -->
<div x-data="{ open: false }" class="mt-2">
    <button @click="open = !open" class="menu-item flex items-center justify-between w-full px-4 py-3 rounded-lg hover:bg-white/10">
        <span class="flex items-center gap-3">
            <i class="fas fa-stamp text-lg text-blue-300"></i>
            <span class="font-medium">Watermark</span>
        </span>
        <i :class="open ? 'fas fa-chevron-up' : 'fas fa-chevron-down'" class="text-xs"></i>
    </button>
    <div :class="open ? 'max-h-96' : 'max-h-0'" class="overflow-hidden transition-all duration-300">
        <div class="submenu ml-4 mt-2 flex flex-col gap-1 py-2">
            <a href="{{ route('watermark.image.index') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-image text-blue-300 w-4"></i> 
                <span>Watermark Gambar</span>
            </a>
            <a href="{{ route('watermark.text.index') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-file-alt text-blue-300 w-4"></i> 
                <span>Watermark Dokumen</span>
            </a>
            <a href="{{ route('watermark.logs.index') }}" class="submenu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm">
                <i class="fas fa-history text-blue-300 w-4"></i> 
                <span>Log Watermark</span>
            </a>
        </div>
    </div>
</div>

<!-- Berita Acara -->
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-4">Berita Acara</div>

<!-- Laporan Kearsipan -->
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
          <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-4">Laporan Kearsipan</div>

        <!-- Pengaturan -->
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
    <div class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 px-4">
        Pengaturan
    </div>

    <!-- Untuk Admin -->
    <a href="{{ route('admin.users.index') }}" 
       class="menu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm hover:bg-gradient-to-r hover:from-gray-500 hover:to-gray-700 transition-all duration-300 group">
        <i class="fas fa-users-cog text-lg text-gray-600 group-hover:text-white"></i>
        <span class="text-gray-700 dark:text-gray-200 group-hover:text-white font-normal">Role & Jabatan</span>
    </a>

    <a href="{{ route('admin.pengaturan.background') }}" 
       class="menu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm hover:bg-gradient-to-r hover:from-indigo-500 hover:to-purple-500 transition-all duration-300 group">
        <i class="fas fa-image text-indigo-400 group-hover:text-white text-lg"></i>
        <span class="text-gray-700 dark:text-gray-200 group-hover:text-white font-normal">Pengaturan Background</span>
    </a>

    <a href="{{ route('admin.pengaturan.nomor') }}" 
       class="menu-item flex items-center gap-3 px-4 py-2 rounded-lg text-sm hover:bg-gradient-to-r hover:from-teal-500 hover:to-green-500 transition-all duration-300 group">
        <i class="fas fa-hashtag text-teal-400 group-hover:text-white text-lg"></i>
        <span class="text-gray-700 dark:text-gray-200 group-hover:text-white font-normal">Pengaturan Nomor Arsip</span>
    </a>
</div>
      </nav>
    </aside>

    <!-- Main Content Area dengan Responsive Layout -->
    <div class="main-content flex flex-col min-h-screen">
      <!-- Enhanced Header -->
      <header class="header px-6 py-4 sticky top-0 z-40">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <!-- Mobile Menu Toggle -->
            <button @click="toggleSidebar()" class="lg:hidden text-gray-700 dark:text-gray-300">
              <i class="fas fa-bars text-xl"></i>
            </button>
            
            <!-- Page Title with Icon -->
            <div class="flex items-center gap-3">
              <a href="{{ route('dashboard') }}" class="text-blue-600 dark:text-blue-400 transition-colors">
                <i class="fas fa-home text-xl"></i>
              </a>
              <div>
                <h1 class="text-xl font-semibold text-gray-800 dark:text-white">Dashboard</h1>
                <p class="text-xs text-gray-500 dark:text-gray-400">Sistem Informasi Arsip Soeradji</p>
              </div>
            </div>
          </div>
          
          <div class="flex items-center gap-4">
            <!-- Dark Mode Toggle -->
            <button @click="toggleDarkMode()" class="text-gray-500 dark:text-gray-400 transition-colors">
              <i :class="darkMode ? 'fas fa-sun' : 'fas fa-moon'" class="text-xl"></i>
            </button>
            
            <!-- Notifications -->
            <div class="relative">
              <button @click="toggleNotifications()" class="relative text-gray-500 dark:text-gray-400 transition-colors">
                <i class="fas fa-bell text-xl"></i>
                <span x-show="unreadCount > 0" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center notification-badge" x-text="unreadCount"></span>
              </button>
              
              <!-- Enhanced Notifications Dropdown -->
              <div x-show="notificationsOpen" 
                   @click.away="notificationsOpen = false" 
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 transform scale-95"
                   x-transition:enter-end="opacity-100 transform scale-100"
                   x-transition:leave="transition ease-in duration-75"
                   x-transition:leave-start="opacity-100 transform scale-100"
                   x-transition:leave-end="opacity-0 transform scale-95"
                   class="absolute right-0 mt-2 w-80 notification-dropdown rounded-xl p-4 z-50">
                <div class="flex items-center justify-between mb-3">
                  <h3 class="font-semibold text-gray-800 dark:text-white">Notifikasi</h3>
                  <button @click="notificationsOpen = false" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="space-y-2 max-h-64 overflow-y-auto custom-scrollbar">
                  <template x-for="notification in unreadNotifications" :key="notification.id">
                    <div class="notification-item p-3 rounded-lg cursor-pointer" @click="markNotificationAsRead(notification.id)">
                      <div class="flex items-start gap-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                          <i class="fas fa-envelope text-blue-500"></i>
                        </div>
                        <div class="flex-1">
                          <p class="font-medium text-gray-800 dark:text-white" x-text="notification.title"></p>
                          <p class="text-xs text-gray-500 dark:text-gray-400" x-text="notification.created_at"></p>
                          <p class="text-xs text-gray-400 dark:text-gray-500 mt-1" x-text="notification.message"></p>
                        </div>
                      </div>
                    </div>
                  </template>
                  <div x-show="unreadNotifications.length === 0" class="text-center py-4 text-gray-500 dark:text-gray-400">
                    <p>Tidak ada notifikasi baru</p>
                  </div>
                </div>
                <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                  <a href="{{ route('notifications.index') }}" class="text-blue-600 hover:text-blue-800 text-sm font-medium">Lihat semua notifikasi</a>
                </div>
              </div>
            </div>
            
            <!-- User Menu -->
            <div class="relative">
              <button @click="toggleProfileMenu()" class="flex items-center gap-3 text-gray-700 dark:text-gray-300">
                <div class="text-right">
                  <p class="text-sm font-medium">{{ $user->nama_lengkap }}</p>
                  <p class="text-xs text-gray-500 dark:text-gray-400">{{ ucfirst($user->role) }}</p>
                </div>
                <div class="relative">
                  @if(!empty($user->profile->foto))
                    <img src="{{ asset('storage/profiles/' . $user->profile->foto) }}" class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm" alt="User"/>
                  @else
                    <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center border-2 border-white shadow-sm">
                      <span class="text-gray-600 font-bold">{{ $user->initials }}</span>
                    </div>
                  @endif
                  <div class="online-indicator">
                    <div class="w-3 h-3 bg-green-400 rounded-full border-2 border-white"></div>
                  </div>
                </div>
                <i class="fas fa-chevron-down text-xs"></i>
              </button>
              
              <!-- Dropdown Menu -->
              <div x-show="profileMenuOpen" 
                   @click.away="profileMenuOpen = false" 
                   x-transition:enter="transition ease-out duration-200"
                   x-transition:enter-start="opacity-0 transform scale-95"
                   x-transition:enter-end="opacity-100 transform scale-100"
                   x-transition:leave="transition ease-in duration-75"
                   x-transition:leave-start="opacity-100 transform scale-100"
                   x-transition:leave-end="opacity-0 transform scale-95"
                   class="absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 rounded-xl shadow-2xl py-2 z-50">
                <a href="{{ route('profile.index') }}" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                  <i class="fas fa-user mr-2"></i> Profil Saya
                </a>
                <a href="#" class="block px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                  <i class="fas fa-cog mr-2"></i> Pengaturan
                </a>
                <hr class="my-1 border-gray-200 dark:border-gray-700">
                <form action="{{ route('logout') }}" method="POST">
                  @csrf
                  <button type="submit" class="block w-full text-left px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-sign-out-alt mr-2"></i> Logout
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- Main Content Area dengan Full Width -->
      <main class="flex-1 overflow-y-auto p-6 content-wrapper pr-20">

        <!-- Welcome Card dengan Animasi -->
        <div class="welcome-card rounded-2xl p-8 mb-8 relative overflow-hidden">
          <div class="relative z-10">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-3xl font-bold text-white mb-2">
                  Selamat datang kembali, {{ $user->nama_lengkap }}! ðŸ‘‹
                </h2>
                <p class="text-blue-100 text-lg mb-4">
                  Sistem Input Arsip Soeradji (SIAS) - {{ date('d F Y') }}
                </p>
                <div class="flex items-center gap-4">
                  <div class="bg-white/20 backdrop-blur rounded-lg px-4 py-2">
                    <p class="text-white/80 text-xs">Login sebagai</p>
                    <p class="text-white font-semibold">{{ ucfirst($user->role) }}</p>
                  </div>
                  <div class="bg-white/20 backdrop-blur rounded-lg px-4 py-2">
                    <p class="text-white/80 text-xs">Jabatan</p>
                    <p class="text-white font-semibold">{{ $user->jabatan }}</p>
                  </div>
                  <div class="bg-white/20 backdrop-blur rounded-lg px-4 py-2">
                    <p class="text-white/80 text-xs">Status</p>
                    <p class="text-white font-semibold">
                      <span class="inline-flex items-center gap-1">
                        <span class="w-2 h-2 bg-green-400 rounded-full"></span>
                        Online
                      </span>
                    </p>
                  </div>
                </div>
              </div>
              <div class="hidden lg:block">
                <lottie-player
                  src="https://assets3.lottiefiles.com/packages/lf20_qhflzjrx.json"
                  background="transparent"
                  speed="1"
                  style="width: 200px; height: 200px;"
                  loop
                  autoplay>
                </lottie-player>
              </div>
            </div>
          </div>
        </div>

        <!-- Stats Cards dengan Animasi -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="stat-card rounded-xl shadow-lg p-6 border-l-4 border-blue-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Arsip Aktif</p>
                <p class="text-3xl font-bold text-gray-900" x-text="loading.stats ? '...' : stats.total_arsip_aktif"></p>
                <p class="text-xs text-green-600 mt-1">
                  <i class="fas fa-arrow-up"></i> 12% dari bulan lalu
                </p>
              </div>
              <div class="bg-gradient-to-br from-blue-400 to-blue-600 rounded-full p-4 shadow-lg">
                <i class="fas fa-folder-open text-white text-2xl"></i>
              </div>
            </div>
          </div>

          <div class="stat-card rounded-xl shadow-lg p-6 border-l-4 border-green-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Arsip Inaktif</p>
                <p class="text-3xl font-bold text-gray-900" x-text="loading.stats ? '...' : stats.total_arsip_inaktif"></p>
                <p class="text-xs text-green-600 mt-1">
                  <i class="fas fa-arrow-up"></i> 8% dari bulan lalu
                </p>
              </div>
              <div class="bg-gradient-to-br from-green-400 to-green-600 rounded-full p-4 shadow-lg">
                <i class="fas fa-archive text-white text-2xl"></i>
              </div>
            </div>
          </div>

          <div class="stat-card rounded-xl shadow-lg p-6 border-l-4 border-purple-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Surat Tugas</p>
                <p class="text-3xl font-bold text-gray-900" x-text="loading.stats ? '...' : stats.total_surat_tugas"></p>
                <p class="text-xs text-green-600 mt-1">
                  <i class="fas fa-arrow-up"></i> 25% dari bulan lalu
                </p>
              </div>
              <div class="bg-gradient-to-br from-purple-400 to-purple-600 rounded-full p-4 shadow-lg">
                <i class="fas fa-file-signature text-white text-2xl"></i>
              </div>
            </div>
          </div>

          <div class="stat-card rounded-xl shadow-lg p-6 border-l-4 border-red-500">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-sm font-medium text-gray-600 mb-1">Berita Acara</p>
                <p class="text-3xl font-bold text-gray-900" x-text="loading.stats ? '...' : (stats.total_berita_pemindahan + stats.total_berita_pemusnahan + stats.total_berita_alihmedia)"></p>
                <p class="text-xs text-green-600 mt-1">
                  <i class="fas fa-arrow-up"></i> 5% dari bulan lalu
                </p>
              </div>
              <div class="bg-gradient-to-br from-red-400 to-red-600 rounded-full p-4 shadow-lg">
                <i class="fas fa-file-alt text-white text-2xl"></i>
              </div>
            </div>
          </div>
        </div>

        <!-- Two Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Today's Activities -->
          <div class="lg:col-span-2">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
              <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Aktivitas Hari Ini</h3>
                <span class="text-sm text-gray-500 dark:text-gray-400">{{ date('d M Y') }}</span>
              </div>
              <div class="space-y-4">
                <template x-for="activity in todayActivities" :key="activity.id">
                  <div class="activity-item">
                    <div class="flex items-start gap-3">
                      <div x-show="activity.user.avatar_url">
                        <img :src="activity.user.avatar_url" class="w-8 h-8 rounded-full object-cover" alt="User"/>
                      </div>
                      <div x-show="!activity.user.avatar_url">
                        <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                          <span class="text-gray-600 text-xs font-bold" x-text="activity.user.initials"></span>
                        </div>
                      </div>
                      <div class="flex-1">
                        <p class="text-sm text-gray-800 dark:text-gray-200">
                          <span class="font-medium" x-text="activity.user.nama_lengkap"></span>
                          <span class="text-gray-500 dark:text-gray-400" x-text="activity.description"></span>
                        </p>
                        <p class="text-xs text-gray-500 dark:text-gray-400" x-text="activity.time"></p>
                      </div>
                    </div>
                  </div>
                </template>
                <div x-show="todayActivities.length === 0 && !loading.activities" class="text-center py-8 text-gray-500 dark:text-gray-400">
                  <p>Belum ada aktivitas hari ini</p>
                </div>
                <div x-show="loading.activities" class="space-y-4">
                  <template x-for="i in 3" :key="i">
                    <div class="animate-pulse">
                      <div class="flex items-start gap-3">
                        <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
                        <div class="flex-1 space-y-2">
                          <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                          <div class="h-3 bg-gray-200 rounded w-1/2"></div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-6">
              <h3 class="text-lg font-semibold text-gray-800 dark:text-white mb-4">Aksi Cepat</h3>
              <div class="space-y-3">
                @if(in_array($user->role, ['admin', 'arsiparis', 'pejabat_struktural']))
                <a href="{{ route('arsip.aktif.create') }}" class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-lg px-4 py-3 hover:from-blue-600 hover:to-blue-700 transition-all duration-200 flex items-center justify-center gap-2">
                  <i class="fas fa-plus"></i>
                  Tambah Arsip Baru
                </a>
                @endif
                
                @if(in_array($user->role, ['admin', 'arsiparis', 'pejabat_struktural']))
                <a href="{{ route('surat_tugas.form') }}" class="w-full bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg px-4 py-3 hover:from-green-600 hover:to-green-700 transition-all duration-200 flex items-center justify-center gap-2">
                  <i class="fas fa-file-signature"></i>
                  Buat Surat Tugas
                </a>
                @endif
                
                @if(in_array($user->role, ['admin', 'arsiparis', 'pejabat_struktural']))
                <a href="#" class="w-full bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg px-4 py-3 hover:from-purple-600 hover:to-purple-700 transition-all duration-200 flex items-center justify-center gap-2">
                  <i class="fas fa-file-alt"></i>
                  Buat Berita Acara
                </a>
                @endif
                
                <a href="#" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg px-4 py-3 hover:from-orange-600 hover:to-orange-700 transition-all duration-200 flex items-center justify-center gap-2">
                  <i class="fas fa-print"></i>
                  Cetak Laporan
                </a>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Enhanced Chat Sidebar dengan Animasi -->
<div class="chat-sidebar">
  <div class="p-4 border-b border-gray-200 dark:border-gray-700">
    <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300 hidden group-hover:block">Online Users</h3>
    <i class="fas fa-comments text-gray-600 dark:text-gray-400 text-xl group-hover:hidden"></i>
  </div>
  <div class="p-2 overflow-y-auto custom-scrollbar h-full">
    <template x-for="user in onlineUsers" :key="user.id">
      <div class="chat-user-item p-2 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 group" @click="openChat(user.id)">
        <div class="flex items-center gap-3">
          <div class="relative">
            <div x-show="user.avatar_url">
              <img :src="user.avatar_url" class="w-8 h-8 rounded-full object-cover" alt="User"/>
            </div>
            <div x-show="!user.avatar_url">
              <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
                <span class="text-gray-600 text-xs font-bold" x-text="user.initials"></span>
              </div>
            </div>
            <div class="online-indicator">
              <div class="w-2 h-2 bg-green-400 rounded-full"></div>
            </div>
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm font-medium text-gray-800 dark:text-gray-200 truncate" x-text="user.nama_lengkap"></p>
            <p class="text-xs text-gray-500 dark:text-gray-400 truncate" x-text="user.jabatan || user.role"></p>
            <p class="text-xs text-gray-400 dark:text-gray-500" x-text="user.last_activity_formatted"></p>
          </div>
        </div>
      </div>
    </template>
    <div x-show="onlineUsers.length === 0 && !loading.onlineUsers" class="text-center py-4 text-gray-500 dark:text-gray-400">
      <p>Tidak ada user online</p>
    </div>
    <div x-show="loading.onlineUsers" class="space-y-2">
      <template x-for="i in 3" :key="i">
        <div class="animate-pulse p-2">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-gray-200 rounded-full"></div>
            <div class="flex-1 space-y-1">
              <div class="h-3 bg-gray-200 rounded w-3/4"></div>
              <div class="h-2 bg-gray-200 rounded w-1/2"></div>
            </div>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>

        <!-- Enhanced Chat Box dengan Minimize Functionality -->
    <div x-show="chatBoxOpen" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform translate-y-4"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform translate-y-4"
         :class="chatMinimized ? 'minimized' : ''"
         class="chat-box fixed bottom-20 right-20 w-96 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl z-40 overflow-hidden">
      
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 flex justify-between items-center">
        <div class="flex items-center gap-2">
          <div class="relative">
            <!-- Tampilkan avatar jika ada -->
            <div x-show="selectedChatUser && selectedChatUser.avatar_url">
              <img :src="selectedChatUser.avatar_url" class="w-8 h-8 rounded-full object-cover" alt="User"/>
            </div>
            <!-- Tampilkan inisial jika tidak ada avatar -->
            <div x-show="!selectedChatUser || !selectedChatUser.avatar_url" class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center">
              <span class="text-white text-xs font-bold" x-text="selectedChatUser ? selectedChatUser.initials : '??'"></span>
            </div>
          </div>
          <div>
            <!-- Tampilkan nama user yang dipilih -->
            <p class="font-medium text-white" x-text="selectedChatUser ? selectedChatUser.nama_lengkap : 'Pilih User'"></p>
            <p class="text-xs text-blue-100">Online</p>
          </div>
        </div>
        <div class="flex items-center gap-2">
          <button @click="minimizeChat()" class="text-white/80 hover:text-white">
            <i :class="chatMinimized ? 'fas fa-expand' : 'fas fa-compress'" class="text-xl"></i>
          </button>
          <button @click="closeChat()" class="text-white/80 hover:text-white">
            <i class="fas fa-times"></i>
          </button>
        </div>
      </div>

      <div class="h-80 overflow-y-auto p-4 bg-gray-50 dark:bg-gray-700 custom-scrollbar">
        <div class="space-y-3" id="chat-messages">
          <div class="flex justify-start">
            <div class="bg-white dark:bg-gray-700 rounded-lg p-3 max-w-xs shadow">
              <p class="text-sm">Halo! Ada yang bisa saya bantu?</p>
            </div>
          </div>
          <div class="flex justify-end">
            <div class="bg-blue-500 text-white rounded-lg p-3 max-w-xs shadow">
              <p class="text-sm">Saya butuh bantuan untuk registrasi arsip</p>
            </div>
          </div>
        </div>
      </div>
      <div class="p-4 border-t border-gray-200 dark:border-gray-700">
        <div class="flex gap-2">
          <input type="text" id="chat-message-input" placeholder="Ketik pesan..." class="flex-1 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400" @keyup.enter="sendMessage()">
          <button @click="sendMessage()" class="bg-blue-500 text-white rounded-lg px-4 py-2 hover:bg-blue-600 transition-colors">
            <i class="fas fa-paper-plane"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Enhanced Profile FAB -->
    <div class="fixed bottom-6 right-6 z-30">
      <div class="relative" x-data="{ open: false }">
        <button @click="open = !open" class="profile-fab rounded-full w-14 h-14 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300">
          <i class="fas fa-user text-xl text-white"></i>
        </button>
        
        <!-- FAB Menu -->
        <div x-show="open" 
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 transform scale-90"
             x-transition:enter-end="opacity-100 transform scale-100"
             x-transition:leave="transition ease-in duration-75"
             x-transition:leave-start="opacity-100 transform scale-100"
             x-transition:leave-end="opacity-0 transform scale-90"
             class="absolute bottom-16 right-0 space-y-2">
          <a href="{{ route('profile.index') }}" class="bg-white dark:bg-gray-800 rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 group">
            <i class="fas fa-user text-gray-600 group-hover:text-purple-600"></i>
          </a>
          <a href="#" class="bg-white dark:bg-gray-800 rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 group">
            <i class="fas fa-key text-gray-600 group-hover:text-purple-600"></i>
          </a>
          <a href="#" class="bg-white dark:bg-gray-800 rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 group">
            <i class="fas fa-cog text-gray-600 group-hover:text-purple-600"></i>
          </a>
          <form action="{{ route('logout') }}" method="POST">
            @csrf
            <button type="submit" class="bg-white dark:bg-gray-800 rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:shadow-xl transform hover:scale-110 transition-all duration-300 group">
              <i class="fas fa-sign-out-alt text-gray-600 group-hover:text-red-600"></i>
            </button>
          </form>
        </div>
      </div>
    </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Request notification permission
      if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission();
      }
      
      // Preload critical resources
      preloadCriticalResources();
    });
    
    function preloadCriticalResources() {
      // Preload images, fonts, and other critical resources
      const resources = [
        '{{ asset("img/logo-soeradji.png") }}',
        'https://assets3.lottiefiles.com/packages/lf20_qhflzjrx.json'
      ];
      
      resources.forEach(resource => {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = resource;
        link.as = resource.endsWith('.json') ? 'fetch' : 'image';
        document.head.appendChild(link);
      });
    }
  </script>
</body>
</html>